<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye Fatigue Detection - OptiTech</title>
    <link rel="stylesheet" href="../static/css/eye_fatigue.css">
    <link rel="shortcut icon" href="/static/favicon.ico">
    <meta name="description" content="AI-powered real-time eye fatigue detection using computer vision">
    <meta name="keywords" content="eye fatigue, computer vision, health monitoring, AI">
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <div class="nav-container">
            <a class="nav-logo">Optitech Eye</a>
            <button class="hamburger">‚ò∞</button>
            <div class="nav-menu">
                <a href="/exercise_full">Eye-Exercise</a>
                <a href="/cataract">Cataract</a>
                <a href="/glaucomaPage">Glaucoma-Test</a>
                <a href="/eye_fatigue" class="active">Eye Fatigue</a>
                <a href="/color_test">Color Blindness Test</a>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <header class="fatigue-header">
        <div class="fatigue-header-content">
            <h1>AI-Powered Eye Fatigue Detection</h1>
            <p>Monitor eye fatigue in real-time using advanced computer vision technology.</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="fatigue-main-container">
        <div class="fatigue-content">
            <p class="fatigue-description">
                This application uses computer vision to detect signs of eye fatigue in real-time
            </p>

            <div class="fatigue-video-container">
                <video id="video-feed" autoplay muted playsinline></video>
                <div class="fatigue-alert" id="fatigue-alert">
                    ‚ö†Ô∏è FATIGUE DETECTED! Take a break!
                </div>
                <div class="fatigue-video-overlay">
                    <div class="fatigue-status-indicator" id="status-indicator">
                        <span class="fatigue-status-dot"></span>
                        <span class="fatigue-status-text">Ready</span>
                    </div>
                </div>
            </div>

            <div class="fatigue-stats-container">
                <div class="fatigue-stat-card">
                    <div class="fatigue-stat-icon">üëÅÔ∏è</div>
                    <div class="fatigue-stat-label">Eye Aspect Ratio (EAR)</div>
                    <div class="fatigue-stat-value" id="ear-value">0.000</div>
                    <div class="fatigue-stat-description">
                        Normal: >0.25 | Fatigue: 0.20-0.25 | Critical: <0.20
                    </div>
                </div>
                
                <div class="fatigue-stat-card">
                    <div class="fatigue-stat-icon">‚è±Ô∏è</div>
                    <div class="fatigue-stat-label">Fatigue Duration</div>
                    <div class="fatigue-stat-value" id="fatigue-duration">0s</div>
                    <div class="fatigue-stat-description">
                        Time with closed/tired eyes
                    </div>
                </div>
            </div>

            <div class="fatigue-controls">
                <button class="fatigue-start-btn" id="start-btn">
                    <span class="fatigue-btn-icon">‚ñ∂Ô∏è</span>
                    Start Detection
                </button>
                <button class="fatigue-stop-btn fatigue-hidden" id="stop-btn">
                    <span class="fatigue-btn-icon">‚èπÔ∏è</span>
                    Stop Detection
                </button>
            </div>

            <!-- Error/Success Messages -->
            <div class="fatigue-message-container">
                <div class="fatigue-alert fatigue-alert-success fatigue-hidden" id="success-alert">
                    <span class="fatigue-alert-icon">‚úÖ</span>
                    <span class="fatigue-alert-message" id="success-message"></span>
                </div>
                <div class="fatigue-alert fatigue-alert-error fatigue-hidden" id="error-alert">
                    <span class="fatigue-alert-icon">‚ùå</span>
                    <span class="fatigue-alert-message" id="error-message"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        ¬© 2025 Optitech Eye Program | Powered by Alphacode
    </footer>

    <script src="/static/js/app.js"></script>
    <script>
        // Toggle hamburger menu on mobile
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        hamburger.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            hamburger.textContent = navMenu.classList.contains('active') ? '‚úï' : '‚ò∞';
        });

        navMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
                hamburger.textContent = '‚ò∞';
            });
        });

        // Add performance monitoring
        let performanceMetrics = {
            startTime: null,
            frameCount: 0,
            lastFPSUpdate: null,
            fps: 0
        };

        function updatePerformanceMetrics() {
            const now = Date.now();
            performanceMetrics.frameCount++;
            
            if (!performanceMetrics.lastFPSUpdate) {
                performanceMetrics.lastFPSUpdate = now;
                return;
            }
            
            const timeDiff = now - performanceMetrics.lastFPSUpdate;
            if (timeDiff >= 1000) {
                performanceMetrics.fps = Math.round(performanceMetrics.frameCount / (timeDiff / 1000));
                performanceMetrics.frameCount = 0;
                performanceMetrics.lastFPSUpdate = now;
                
                const statusText = document.querySelector('.fatigue-status-text');
                if (statusText && performanceMetrics.fps > 0) {
                    statusText.textContent = `Active (${performanceMetrics.fps} FPS)`;
                }
            }
        }

        // Camera permission check
        async function checkCameraPermission() {
            try {
                const permissions = await navigator.permissions.query({ name: 'camera' });
                const statusIndicator = document.getElementById('status-indicator');
                
                switch (permissions.state) {
                    case 'granted':
                        statusIndicator.classList.add('fatigue-status-ready');
                        break;
                    case 'denied':
                        statusIndicator.classList.add('fatigue-status-error');
                        document.querySelector('.fatigue-status-text').textContent = 'Camera Denied';
                        break;
                    case 'prompt':
                        statusIndicator.classList.add('fatigue-status-warning');
                        document.querySelector('.fatigue-status-text').textContent = 'Camera Permission Required';
                        break;
                }
            } catch (error) {
                console.log('Permission API not supported');
            }
        }

        // Initialize camera permission check
        checkCameraPermission();
    </script>
</body>
</html>